=== PHASE 9: MONITORING & ERROR REPORTING ===

9.1 Checking if Sentry is installed...
time="2025-10-19T01:46:41+05:30" level=warning msg="C:\\Users\\srina\\OneDrive\\Documents\\Downloads\\Stealth-Reecovery-20251010T154256Z-1-001\\Stealth-Reecovery\\docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"

[notice] A new release of pip is available: 24.0 -> 25.2
[notice] To update, run: pip install --upgrade pip
sentry-sdk         2.19.2

9.2 Checking structured logging configuration...
time="2025-10-19T01:46:45+05:30" level=warning msg="C:\\Users\\srina\\OneDrive\\Documents\\Downloads\\Stealth-Reecovery-20251010T154256Z-1-001\\Stealth-Reecovery\\docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
"""
Structured logging configuration using structlog.
"""
import structlog
import logging
import sys
from typing import Any, Dict

# Configure standard library logging
logging.basicConfig(
    format="%(message)s",
    stream=sys.stdout,
    level=logging.INFO,
)


def add_app_context(logger: Any, method_name: str, event_dict: Dict) -> Dict:
    """Add application context to log entries."""
    event_dict['app'] = 'stealth-recovery'
    event_dict['environment'] = 'development'  # Override via env var in production

9.3 Verifying logging middleware...
time="2025-10-19T01:46:46+05:30" level=warning msg="C:\\Users\\srina\\OneDrive\\Documents\\Downloads\\Stealth-Reecovery-20251010T154256Z-1-001\\Stealth-Reecovery\\docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
async def request_id_middleware(request: Request, call_next: Callable) -> Response:
    """
    Add unique request_id to each request for tracing.
    Binds request_id to structlog context for all logs in this request.
    """
    # Generate or extract request ID

9.4 Testing structured logging output...
{"detail":"Not authenticated"}
9.5 Checking backend logs for structured JSON...
time="2025-10-19T01:46:47+05:30" level=warning msg="C:\\Users\\srina\\OneDrive\\Documents\\Downloads\\Stealth-Reecovery-20251010T154256Z-1-001\\Stealth-Reecovery\\docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
backend-1  | {"status_code": 200, "duration_ms": 2.02, "event": "request_completed", "request_id": "8f20f21b-cef1-4503-bb1f-3e4684a2de60", "method": "GET", "path": "/openapi.json", "logger": "app.middleware", "level": "info", "app": "stealth-recovery", "environment": "development", "timestamp": "2025-10-18T20:11:01.978998Z"}
backend-1  | {"method": "GET", "path": "/v1/auth/me", "client_host": "172.18.0.1", "event": "request_started", "request_id": "4647bea6-e7df-4201-9f8f-a0ecea75531b", "logger": "app.middleware", "level": "info", "app": "stealth-recovery", "environment": "development", "timestamp": "2025-10-18T20:16:46.525592Z"}
backend-1  | {"status_code": 403, "duration_ms": 60.15, "event": "request_completed", "request_id": "4647bea6-e7df-4201-9f8f-a0ecea75531b", "method": "GET", "path": "/v1/auth/me", "logger": "app.middleware", "level": "info", "app": "stealth-recovery", "environment": "development", "timestamp": "2025-10-18T20:16:46.605881Z"}

âœ… PHASE 9 COMPLETE
   Status: Structured logging configured, request IDs active
   Note: Sentry integration available but not configured (requires DSN)
